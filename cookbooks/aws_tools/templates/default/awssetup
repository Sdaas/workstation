## ---------------------------------------------------------------------------
##
##
## Do not edit this file unless you know what you are doing ##
##
##
## ----------------------------------------------------------------------------

#
# This is the common setup file that is called by all the bash scripts to set up the environment
#
# All the following environement variables must be defined. Otherwise the scripts will not work.
#
#export AWS_REGION=us-west-1
#export AWS_CREDENTIAL_FILE=XXXXXX
#export EC2_PRIVATE_KEY=XXXXXX
#export EC2_CERT=XXXXXX

# This script also requires that the AWS_CREDENTIAL_FILE have the following contents
#
# AWSAccessKeyId=xxxx
# AWSSecretKey=xxxx
#


# Set the AWS Region Endpoints
if [ ! $AWS_REGION ]; then

	echo "*** Error: AWS_REGION needs to be defined"

else
	# Set the endpoints of all AWS services based on $AWS_REGION. This is needed so that all the command-line tools
	# point to the right AWS Region. See http://docs.amazonwebservices.com/general/latest/gr/rande.html 
	if [ $AWS_REGION = "us-east-1" ]; then
		export EC2_URL=https://ec2.us-east-1.amazonaws.com
		export AWS_CLOUDFORMATION_URL=https://cloudformation.us-east-1.amazonaws.com
		export AWS_AUTO_SCALING_URL=https://autoscaling.us-east-1.amazonaws.com
		export AWS_ELB_URL=https://elasticloadbalancing.us-east-1.amazonaws.com
		export ELASTICBEANSTALK_URL=https://elasticbeanstalk.us-east-1.amazonaws.com
		export SIMPLEDB_URL=https://sdb.amazonaws.com
		export S3_URL=https://s3.amazonaws.com
	elif [ $AWS_REGION = "us-west-1" ]; then
		export EC2_URL=https://ec2.us-west-1.amazonaws.com
		export AWS_CLOUDFORMATION_URL=https://cloudformation.us-west-1.amazonaws.com
		export AWS_AUTO_SCALING_URL=https://autoscaling.us-west-1.amazonaws.com
		export AWS_ELB_URL=https://elasticloadbalancing.us-west-1.amazonaws.com
		export ELASTICBEANSTALK_URL=https://elasticbeanstalk.us-west-1.amazonaws.com
		export SIMPLEDB_URL=https://sdb.us-west-1.amazonaws.com
		export S3_URL=s3-us-west-1.amazonaws.com
	elif [ $AWS_REGION = "us-west-2" ]; then
		export EC2_URL=https://ec2.us-west-2.amazonaws.com
		export AWS_CLOUDFORMATION_URL=https://cloudformation.us-west-2.amazonaws.com
		export AWS_AUTO_SCALING_URL=https://autoscaling.us-west-2.amazonaws.com
		export AWS_ELB_URL=https://elasticloadbalancing.us-west-2.amazonaws.com
		export ELASTICBEANSTALK_URL=https://elasticbeanstalk.us-west-2.amazonaws.com
		export SIMPLEDB_URL=https://sdb.us-west-2.amazonaws.com
		export S3_URL=https://s3-us-west-2.amazonaws.com
	else
		echo "*** ERROR : $AWS_REGION is not a supported AWS Region"
		exit -1;
	fi

fi


if [ ! $EC2_PRIVATE_KEY ]; then
	echo "*** Error: EC2_PRIVATE_KEY needs to be defined"
fi

if [ ! $EC2_CERT ]; then
	echo "*** Error: EC2_CERT needs to be defined"
fi



if [ ! $AWS_CREDENTIAL_FILE ]; then
	echo "*** Error: AWS_CREDENTIAL_FILE needs to be defined"
elif [ ! -e $AWS_CREDENTIAL_FILE  ]; then
	echo "*** Error: The AWS Credentials File $AWS_CREDENTIAL_FILE does not exist"
else

	# Read the keys from the AWS Credential file and set those variables
	# Export the AWS Keys to be used by S3CMD
	for line in `cat ${AWS_CREDENTIAL_FILE}`
	do
	     ## echo "$line"
	     export $line
	done

	# Confirm that the right vars have been loaded from the AWS_ CREDENTIAL_FILE
	if [ ! $AWSAccessKeyId ]; then
		echo "*** Error: AWSAccessKeyId not defined. Did you forget to define it in ${AWS_ CREDENTIAL_FILE} ?"
	fi

	if [ ! $AWSSecretKey ]; then
		echo "*** Error: AWSSecretKey not defined. Did you forget to define it in ${AWS_ CREDENTIAL_FILE} ?"
	fi

fi














